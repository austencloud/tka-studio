<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TKA Complete Pictograph Rendering System Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.8em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.3em;
            opacity: 0.9;
            margin: 10px 0;
        }
        
        .feature-badges {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .badge {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .demo-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 25px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .pictograph-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .pictograph-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .pictograph-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            border-radius: 15px 15px 0 0;
        }
        
        .card-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            color: #ffffff;
        }
        
        .card-subtitle {
            font-size: 0.95em;
            opacity: 0.8;
            text-align: center;
            margin-bottom: 20px;
            font-style: italic;
        }
        
        .pictograph-svg {
            width: 100%;
            height: auto;
            max-width: 300px;
            margin: 0 auto 15px;
            display: block;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border: 3px solid rgba(255,255,255,0.1);
        }
        
        .motion-info {
            margin-top: 15px;
            font-size: 0.85em;
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .motion-info .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            padding: 2px 0;
        }
        
        .motion-info .info-label {
            font-weight: bold;
            opacity: 0.9;
        }
        
        .motion-info .info-value {
            color: #4ecdc4;
            font-weight: bold;
        }
        
        .load-button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
        }
        
        .load-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            background: linear-gradient(45deg, #ff5252, #ff3d00);
        }
        
        .status {
            text-align: center;
            margin: 25px 0;
            font-size: 1.2em;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
        }
        
        .error {
            color: #ff6b6b;
            background: rgba(255,107,107,0.15);
            border: 2px solid rgba(255,107,107,0.3);
        }
        
        .success {
            color: #51cf66;
            background: rgba(81,207,102,0.15);
            border: 2px solid rgba(81,207,102,0.3);
        }
        
        .loading {
            color: #4ecdc4;
            background: rgba(78,205,196,0.15);
            border: 2px solid rgba(78,205,196,0.3);
        }
        
        .system-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .status-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .status-item .status-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .status-item .status-label {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .loading .status-icon {
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé® TKA Complete Pictograph Rendering System</h1>
        <p>Sophisticated Arrow Positioning + Prop Rendering + Desktop Parity</p>
        
        <div class="feature-badges">
            <div class="badge">üéØ Sophisticated Positioning</div>
            <div class="badge">üé≠ Prop Rendering</div>
            <div class="badge">üîÑ Complex Placement Keys</div>
            <div class="badge">üìä Real Adjustment Data</div>
            <div class="badge">‚ö° Runes State Management</div>
        </div>
    </div>
    
    <button class="load-button" onclick="loadCompleteDemo()">üöÄ Load Complete Rendering System</button>
    
    <div id="status" class="status">Click the button above to see the complete pictograph rendering system in action!</div>
    
    <div id="system-status" class="system-status" style="display: none;"></div>
    
    <div id="demo-container" class="demo-container"></div>

    <script type="module">
        // Advanced test cases showcasing complete system
        const advancedTestCases = [
            {
                name: "PRO Staff Motion with Letter A",
                subtitle: "Sophisticated arrow positioning + staff prop rendering",
                description: "Demonstrates complex placement key generation with prop integration",
                data: {
                    id: "pro-staff-A",
                    gridData: { mode: 'diamond' },
                    motions: {
                        blue: {
                            motionType: 'pro',
                            propRotDir: 'cw',
                            startLoc: 'n',
                            endLoc: 's',
                            turns: 1,
                            startOri: 'in',
                            endOri: 'out'
                        }
                    },
                    letter: 'A'
                },
                propType: 'staff'
            },
            {
                name: "ANTI Hand Motion with Dash Letter",
                subtitle: "Œ∏- letter handling + hand prop rendering", 
                description: "Complex dash letter processing with anti motion",
                data: {
                    id: "anti-hand-theta-dash",
                    gridData: { mode: 'diamond' },
                    motions: {
                        red: {
                            motionType: 'anti',
                            propRotDir: 'ccw',
                            startLoc: 'e',
                            endLoc: 'w',
                            turns: 0.5,
                            startOri: 'out',
                            endOri: 'in'
                        }
                    },
                    letter: 'Œ∏-'
                },
                propType: 'hand'
            },
            {
                name: "Dual Motion Complex Sequence",
                subtitle: "Both arrows + both props with sophisticated positioning",
                description: "Complete dual motion with different prop types",
                data: {
                    id: "dual-complex",
                    gridData: { mode: 'diamond' },
                    motions: {
                        blue: {
                            motionType: 'pro',
                            propRotDir: 'cw',
                            startLoc: 'n',
                            endLoc: 's',
                            turns: 2,
                            startOri: 'in',
                            endOri: 'out'
                        },
                        red: {
                            motionType: 'anti',
                            propRotDir: 'ccw',
                            startLoc: 's',
                            endLoc: 'n',
                            turns: 1.5,
                            startOri: 'in',
                            endOri: 'out'
                        }
                    },
                    letter: 'Œ≤'
                },
                propType: 'fan'
            },
            {
                name: "FLOAT Fan Motion",
                subtitle: "Special float handling + fan prop rendering",
                description: "Float motion with 'fl' turns and fan props",
                data: {
                    id: "float-fan",
                    gridData: { mode: 'diamond' },
                    motions: {
                        blue: {
                            motionType: 'float',
                            propRotDir: 'no_rot',
                            startLoc: 'center',
                            endLoc: 'center',
                            turns: 'fl',
                            startOri: 'in',
                            endOri: 'in'
                        }
                    },
                    letter: null
                },
                propType: 'fan'
            },
            {
                name: "Complex DASH Motion",
                subtitle: "Advanced dash positioning + staff props",
                description: "DASH motion with layer calculations",
                data: {
                    id: "dash-complex",
                    gridData: { mode: 'diamond' },
                    motions: {
                        red: {
                            motionType: 'dash',
                            propRotDir: 'cw',
                            startLoc: 'nw',
                            endLoc: 'se',
                            turns: 1.5,
                            startOri: 'clock',
                            endOri: 'counter'
                        }
                    },
                    letter: 'Œì'
                },
                propType: 'staff'
            },
            {
                name: "STATIC Multi-Prop Showcase",
                subtitle: "STATIC positioning with multiple prop types",
                description: "Demonstrates static motion prop positioning",
                data: {
                    id: "static-multi",
                    gridData: { mode: 'diamond' },
                    motions: {
                        blue: {
                            motionType: 'static',
                            propRotDir: 'cw',
                            startLoc: 'w',
                            endLoc: 'e',
                            turns: 0,
                            startOri: 'in',
                            endOri: 'out'
                        },
                        red: {
                            motionType: 'static',
                            propRotDir: 'ccw',
                            startLoc: 'e',
                            endLoc: 'w',
                            turns: 0,
                            startOri: 'out',
                            endOri: 'in'
                        }
                    },
                    letter: 'Œ£'
                },
                propType: 'hand'
            }
        ];
        
        // Complete rendering system simulation
        class CompleteRenderingDemo {
            constructor() {
                this.systemReady = false;
                this.services = {};
                
                // Advanced placement data with prop integration
                this.placementData = {
                    diamond: {
                        pro: {
                            "pro_to_layer1_alpha": { "1": [-35, -15], "2": [45, -40] },
                            "pro_to_layer1_alpha_A": { "1": [-25, -10], "2": [50, -35] },
                            "pro_to_layer1_beta": { "1.5": [-100, 150], "2": [45, -40] }
                        },
                        anti: {
                            "anti_to_layer2_alpha": { "0.5": [-90, 65], "1.5": [-30, 70] },
                            "anti_to_layer2_alpha_Œ∏_dash": { "0.5": [-100, 70], "1.5": [-40, 75] }
                        },
                        float: {
                            "float_to_layer1_alpha": { "fl": [30, -30] }
                        },
                        dash: {
                            "dash_to_layer1_gamma": { "1.5": [25, -115] },
                            "dash_to_layer1_gamma_Œì": { "1.5": [30, -120] }
                        },
                        static: {
                            "static_to_layer2_alpha": { "0": [0, 0] },
                            "static_to_layer2_alpha_Œ£": { "0": [10, 5] }
                        }
                    }
                };
                
                this.propStyles = {
                    staff: { scale: 0.3, offsetX: 0, offsetY: 0 },
                    hand: { scale: 0.25, offsetX: -5, offsetY: -5 },
                    fan: { scale: 0.35, offsetX: 0, offsetY: -3 }
                };
            }
            
            async initializeSystem() {
                console.log('üöÄ Initializing complete rendering system...');
                
                // Simulate system initialization steps
                const steps = [
                    'Loading placement data service',
                    'Initializing arrow positioning service',
                    'Setting up prop rendering service',
                    'Configuring sophisticated algorithms',
                    'Validating service dependencies',
                    'Loading prop SVG assets',
                    'Finalizing system integration'
                ];
                
                for (let i = 0; i < steps.length; i++) {
                    this.updateSystemStatus(steps[i], i, steps.length);
                    await this.sleep(500); // Simulate initialization time
                }
                
                this.systemReady = true;
                console.log('‚úÖ Complete rendering system initialized');
            }
            
            updateSystemStatus(step, current, total) {
                const statusDiv = document.getElementById('system-status');
                statusDiv.style.display = 'grid';
                statusDiv.innerHTML = `
                    <div class="status-item loading">
                        <div class="status-icon">‚ö°</div>
                        <div class="status-label">Initializing</div>
                    </div>
                    <div class="status-item">
                        <div class="status-icon">üìä</div>
                        <div class="status-label">${step}</div>
                    </div>
                    <div class="status-item">
                        <div class="status-icon">üìà</div>
                        <div class="status-label">${current + 1}/${total} Steps</div>
                    </div>
                `;
            }
            
            generatePlacementKey(motionData, pictographData) {
                const motionType = motionData.motionType;
                const letter = pictographData.letter;
                
                if (letter) {
                    if (letter.includes('-')) {
                        const baseString = letter.replace('-', '_dash');
                        return `${motionType}_to_layer2_alpha_${baseString}`;
                    } else {
                        return `${motionType}_to_layer1_alpha_${letter}`;
                    }
                }
                
                // Advanced layer detection based on motion type
                if (motionType === 'dash') {
                    return `${motionType}_to_layer1_gamma`;
                } else if (motionType === 'static') {
                    return `${motionType}_to_layer2_alpha`;
                } else {
                    return `${motionType}_to_layer1_alpha`;
                }
            }
            
            getAdjustment(motionType, placementKey, turns) {
                const data = this.placementData.diamond?.[motionType]?.[placementKey]?.[turns.toString()];
                if (data) {
                    console.log(`üéØ Sophisticated adjustment: ${placementKey}[${turns}] = [${data[0]}, ${data[1]}]`);
                    return { x: data[0], y: data[1] };
                }
                console.log(`‚ö†Ô∏è Using default adjustment for: ${placementKey}[${turns}]`);
                return { x: 0, y: 0 };
            }
            
            calculateArrowPosition(motionData, pictographData) {
                const locationMap = {
                    n: { x: 150, y: 70 }, ne: { x: 206, y: 94 }, e: { x: 230, y: 150 },
                    se: { x: 206, y: 206 }, s: { x: 150, y: 230 }, sw: { x: 94, y: 206 },
                    w: { x: 70, y: 150 }, nw: { x: 94, y: 94 }, center: { x: 150, y: 150 }
                };
                
                const basePos = locationMap[motionData.startLoc] || { x: 150, y: 150 };
                const placementKey = this.generatePlacementKey(motionData, pictographData);
                const adjustment = this.getAdjustment(motionData.motionType, placementKey, motionData.turns);
                
                const rotationMap = {
                    'pro-cw': 0, 'pro-ccw': 180,
                    'anti-cw': 180, 'anti-ccw': 0,
                    'float': 45, 'dash-cw': 90, 'dash-ccw': 270,
                    'static': 0
                };
                
                const rotKey = `${motionData.motionType}-${motionData.propRotDir}`;
                const rotation = rotationMap[rotKey] || rotationMap[motionData.motionType] || 0;
                
                return {
                    x: basePos.x + adjustment.x,
                    y: basePos.y + adjustment.y,
                    rotation: rotation,
                    placementKey: placementKey,
                    adjustment: adjustment
                };
            }
            
            calculatePropPosition(motionData, color, propType) {
                const locationMap = {
                    n: { x: 150, y: 102 }, ne: { x: 181, y: 119 }, e: { x: 198, y: 150 },
                    se: { x: 181, y: 181 }, s: { x: 150, y: 198 }, sw: { x: 119, y: 181 },
                    w: { x: 102, y: 150 }, nw: { x: 119, y: 119 }, center: { x: 150, y: 150 }
                };
                
                const basePos = locationMap[motionData.endLoc] || { x: 150, y: 150 };
                const propStyle = this.propStyles[propType] || this.propStyles.staff;
                
                // Color separation
                const colorOffset = color === 'blue' ? { x: -8, y: -8 } : { x: 8, y: 8 };
                
                // Rotation based on end orientation
                const orientationRotations = {
                    'in': 0, 'out': 180, 'clock': 90, 'counter': 270
                };
                const rotation = orientationRotations[motionData.endOri] || 0;
                
                return {
                    x: basePos.x + propStyle.offsetX + colorOffset.x,
                    y: basePos.y + propStyle.offsetY + colorOffset.y,
                    rotation: rotation,
                    scale: propStyle.scale
                };
            }
            
            async renderPictograph(testCase) {
                if (!this.systemReady) {
                    throw new Error('System not initialized');
                }
                
                console.log(`üé® Rendering complete pictograph: ${testCase.data.id}`);
                
                const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.setAttribute('width', '300');
                svg.setAttribute('height', '300');
                svg.setAttribute('viewBox', '0 0 300 300');
                
                // Background
                const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                bg.setAttribute('width', '100%');
                bg.setAttribute('height', '100%');
                bg.setAttribute('fill', '#ffffff');
                svg.appendChild(bg);
                
                // Enhanced grid
                this.renderGrid(svg);
                
                // Render arrows and props
                const elements = [];
                
                if (testCase.data.motions?.blue) {
                    const arrowPos = this.calculateArrowPosition(testCase.data.motions.blue, testCase.data);
                    this.renderArrow(svg, 'blue', arrowPos);
                    
                    const propPos = this.calculatePropPosition(testCase.data.motions.blue, 'blue', testCase.propType);
                    await this.renderProp(svg, 'blue', testCase.propType, propPos);
                    
                    elements.push({ type: 'blue', arrow: arrowPos, prop: propPos });
                }
                
                if (testCase.data.motions?.red) {
                    const arrowPos = this.calculateArrowPosition(testCase.data.motions.red, testCase.data);
                    this.renderArrow(svg, 'red', arrowPos);
                    
                    const propPos = this.calculatePropPosition(testCase.data.motions.red, 'red', testCase.propType);
                    await this.renderProp(svg, 'red', testCase.propType, propPos);
                    
                    elements.push({ type: 'red', arrow: arrowPos, prop: propPos });
                }
                
                // Enhanced metadata
                this.addAdvancedMetadata(svg, testCase, elements);
                
                return svg;
            }
            
            renderGrid(svg) {
                // Main diamond
                const diamond = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
                diamond.setAttribute('points', '150,50 250,150 150,250 50,150');
                diamond.setAttribute('fill', 'none');
                diamond.setAttribute('stroke', '#e5e7eb');
                diamond.setAttribute('stroke-width', '2');
                svg.appendChild(diamond);
                
                // Grid points indicators
                const locations = [
                    {name: 'N', x: 150, y: 50}, {name: 'E', x: 250, y: 150},
                    {name: 'S', x: 150, y: 250}, {name: 'W', x: 50, y: 150}
                ];
                
                locations.forEach(loc => {
                    const point = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    point.setAttribute('cx', loc.x);
                    point.setAttribute('cy', loc.y);
                    point.setAttribute('r', '3');
                    point.setAttribute('fill', '#cbd5e1');
                    point.setAttribute('opacity', '0.6');
                    svg.appendChild(point);
                });
            }
            
            renderArrow(svg, color, position) {
                const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                group.setAttribute('transform', `translate(${position.x}, ${position.y}) rotate(${position.rotation})`);
                group.setAttribute('class', `sophisticated-arrow-${color}`);
                
                const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                arrow.setAttribute('d', 'M 0,-25 L 15,0 L 0,25 L -8,15 L -8,-15 Z');
                arrow.setAttribute('fill', color);
                arrow.setAttribute('stroke', '#000');
                arrow.setAttribute('stroke-width', '2');
                arrow.setAttribute('opacity', '0.9');
                arrow.setAttribute('filter', 'drop-shadow(1px 1px 2px rgba(0,0,0,0.3))');
                
                const indicator = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                indicator.setAttribute('cx', '0');
                indicator.setAttribute('cy', '0');
                indicator.setAttribute('r', '3');
                indicator.setAttribute('fill', color === 'blue' ? '#0066ff' : '#ff0066');
                indicator.setAttribute('opacity', '0.7');
                
                group.appendChild(arrow);
                group.appendChild(indicator);
                svg.appendChild(group);
                
                console.log(`üèπ Rendered ${color} arrow with sophisticated positioning:`, position);
            }
            
            async renderProp(svg, color, propType, position) {
                try {
                    // Simulate SVG loading with enhanced prop shapes
                    const propShapes = {
                        staff: 'M-30,-5 L30,-5 L35,0 L30,5 L-30,5 L-35,0 Z M-5,-15 L5,-15 L5,15 L-5,15 Z',
                        hand: 'M-10,-15 C-15,-20 -15,-25 -10,-25 L10,-25 C15,-25 15,-20 10,-15 L10,10 C10,15 5,15 0,15 C-5,15 -10,15 -10,10 Z',
                        fan: 'M0,-20 L-15,-10 L-20,0 L-15,10 L0,20 L15,10 L20,0 L15,-10 Z M0,-5 L0,5 M-10,0 L10,0'
                    };
                    
                    const group = document.createElementNS('http://www.w3.org/2000/svg', 'g');
                    group.setAttribute('transform', 
                        `translate(${position.x}, ${position.y}) rotate(${position.rotation}) scale(${position.scale})`);
                    group.setAttribute('class', `prop-${color} prop-${propType}`);
                    
                    const prop = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    prop.setAttribute('d', propShapes[propType] || propShapes.staff);
                    prop.setAttribute('fill', color === 'blue' ? '#2E3192' : '#ED1C24');
                    prop.setAttribute('stroke', '#000');
                    prop.setAttribute('stroke-width', '1');
                    prop.setAttribute('opacity', '0.8');
                    prop.setAttribute('filter', 'drop-shadow(1px 1px 1px rgba(0,0,0,0.2))');
                    
                    group.appendChild(prop);
                    svg.appendChild(group);
                    
                    console.log(`üé≠ Rendered ${color} ${propType} prop at position:`, position);
                } catch (error) {
                    console.error(`‚ùå Error rendering ${propType} prop:`, error);
                }
            }
            
            addAdvancedMetadata(svg, testCase, elements) {
                // Title
                const title = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                title.setAttribute('x', '150');
                title.setAttribute('y', '280');
                title.setAttribute('text-anchor', 'middle');
                title.setAttribute('font-family', 'monospace');
                title.setAttribute('font-size', '11');
                title.setAttribute('fill', '#4b5563');
                title.textContent = `${testCase.data.id} ‚Ä¢ Complete System`;
                svg.appendChild(title);
                
                // Advanced positioning info
                let yOffset = 15;
                elements.forEach(element => {
                    // Arrow info
                    const arrowText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    arrowText.setAttribute('x', '10');
                    arrowText.setAttribute('y', yOffset.toString());
                    arrowText.setAttribute('font-family', 'monospace');
                    arrowText.setAttribute('font-size', '8');
                    arrowText.setAttribute('fill', '#6b7280');
                    arrowText.textContent = `${element.type}: ${element.arrow.placementKey}`;
                    svg.appendChild(arrowText);
                    yOffset += 9;
                    
                    // Prop info
                    const propText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    propText.setAttribute('x', '10');
                    propText.setAttribute('y', yOffset.toString());
                    propText.setAttribute('font-family', 'monospace');
                    propText.setAttribute('font-size', '8');
                    propText.setAttribute('fill', '#059669');
                    propText.textContent = `${testCase.propType}: [${element.prop.x.toFixed(0)}, ${element.prop.y.toFixed(0)}]`;
                    svg.appendChild(propText);
                    yOffset += 12;
                });
                
                // Letter info
                if (testCase.data.letter) {
                    const letterText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    letterText.setAttribute('x', '10');
                    letterText.setAttribute('y', yOffset.toString());
                    letterText.setAttribute('font-family', 'monospace');
                    letterText.setAttribute('font-size', '9');
                    letterText.setAttribute('fill', '#7c3aed');
                    letterText.setAttribute('font-weight', 'bold');
                    letterText.textContent = `Letter: ${testCase.data.letter}`;
                    svg.appendChild(letterText);
                }
            }
            
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }
        
        // Global demo function
        window.loadCompleteDemo = async function() {
            const statusDiv = document.getElementById('status');
            const containerDiv = document.getElementById('demo-container');
            
            statusDiv.className = 'status loading';
            statusDiv.innerHTML = 'üöÄ Initializing complete pictograph rendering system...';
            
            try {
                const demo = new CompleteRenderingDemo();
                await demo.initializeSystem();
                
                statusDiv.className = 'status success';
                statusDiv.innerHTML = '‚úÖ Complete rendering system operational! Generating advanced pictographs...';
                
                // Hide system status
                document.getElementById('system-status').style.display = 'none';
                
                // Clear container
                containerDiv.innerHTML = '';
                
                // Render all advanced test cases
                for (const testCase of advancedTestCases) {
                    const card = document.createElement('div');
                    card.className = 'pictograph-card';
                    
                    const title = document.createElement('div');
                    title.className = 'card-title';
                    title.textContent = testCase.name;
                    card.appendChild(title);
                    
                    const subtitle = document.createElement('div');
                    subtitle.className = 'card-subtitle';
                    subtitle.textContent = testCase.subtitle;
                    card.appendChild(subtitle);
                    
                    try {
                        const svg = await demo.renderPictograph(testCase);
                        svg.className = 'pictograph-svg';
                        card.appendChild(svg);
                        
                        // Enhanced motion info
                        const motionInfo = document.createElement('div');
                        motionInfo.className = 'motion-info';
                        
                        let infoHTML = `
                            <div class="info-row">
                                <span class="info-label">ID:</span>
                                <span class="info-value">${testCase.data.id}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Prop Type:</span>
                                <span class="info-value">${testCase.propType}</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Letter:</span>
                                <span class="info-value">${testCase.data.letter || 'None'}</span>
                            </div>
                        `;
                        
                        if (testCase.data.motions.blue) {
                            infoHTML += `
                                <div class="info-row">
                                    <span class="info-label">Blue Motion:</span>
                                    <span class="info-value">${testCase.data.motions.blue.motionType} (${testCase.data.motions.blue.turns})</span>
                                </div>
                            `;
                        }
                        
                        if (testCase.data.motions.red) {
                            infoHTML += `
                                <div class="info-row">
                                    <span class="info-label">Red Motion:</span>
                                    <span class="info-value">${testCase.data.motions.red.motionType} (${testCase.data.motions.red.turns})</span>
                                </div>
                            `;
                        }
                        
                        infoHTML += `
                            <div class="info-row">
                                <span class="info-label">Features:</span>
                                <span class="info-value">Complete System</span>
                            </div>
                        `;
                        
                        motionInfo.innerHTML = infoHTML;
                        card.appendChild(motionInfo);
                        
                    } catch (error) {
                        console.error('Error rendering pictograph:', error);
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'error';
                        errorDiv.textContent = `Rendering failed: ${error.message}`;
                        card.appendChild(errorDiv);
                    }
                    
                    containerDiv.appendChild(card);
                }
                
                statusDiv.innerHTML = `
                    üéâ Complete Pictograph Rendering System Demo Complete!<br>
                    <small>‚ú® Sophisticated Arrow Positioning + Prop Rendering + Desktop Parity Algorithms ‚ú®</small>
                `;
                
            } catch (error) {
                console.error('Demo failed:', error);
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `‚ùå Demo failed: ${error.message}`;
            }
        };
    </script>
</body>
</html>