# Sequence Index Management

## Overview

The browse service uses a pre-generated sequence index (`static/sequence-index.json`) for fast loading of sequence metadata. This index is automatically generated from the real dictionary folders and kept in sync.

## How It Works

1. **Real Data Source**: The index is generated by scanning `static/dictionary/` folders
2. **Automatic Updates**: The index regenerates when dictionary files change
3. **Fast Loading**: Browse service loads one JSON file instead of scanning hundreds of folders

## Scripts

- `npm run generate:index` - Generate index once from dictionary
- `npm run dev:auto` - Development with automatic index updates
- `npm run build` - Production build (auto-generates index)

## File Watching

The system watches for:

- New PNG files in dictionary folders
- New dictionary folders created
- Deleted sequences

Changes trigger automatic index regeneration after a 2-second debounce.

## Architecture

```
static/dictionary/
├── SEQUENCE_NAME/
│   ├── SEQUENCE_NAME_ver1.png
│   ├── SEQUENCE_NAME_ver2.png
│   └── __init__.py
└── ...

↓ (automatic generation)

static/sequence-index.json
├── metadata for all sequences
├── thumbnail paths
├── difficulty estimates
└── proper GridMode values
```

## Never Out of Sync

The automation ensures:

- ✅ Index updates before every dev server start
- ✅ Index updates before every build
- ✅ Index updates when dictionary files change
- ✅ Validation prevents fake sequences
- ✅ Real sequences only (scanned from actual folders)

## Performance

- **Cold start**: ~500ms to scan 373 sequences
- **Runtime**: ~50ms to load pre-generated index
- **File watch**: Updates only when needed
- **Debounced**: Multiple changes = single regeneration
